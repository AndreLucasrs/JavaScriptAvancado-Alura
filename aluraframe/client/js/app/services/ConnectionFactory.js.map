{"version":3,"sources":["../../app-es6/services/ConnectionFactory.js"],"names":["ConnectionFactory","stores","version","dbName","connection","close","Error","Promise","resolve","reject","openRequest","window","indexedDB","open","onupgradeneeded","_createStores","e","target","result","onsuccess","bind","onerror","console","log","error","name","forEach","objectStoreNames","contains","store","deleteObjectStore","createObjectStore","autoIncrement"],"mappings":";;;;;;AAAA;AACA;AACA,IAAIA,oBAAqB,YAAW;;AAEnC,KAAMC,SAAS,CAAC,aAAD,CAAf;AACA,KAAMC,UAAU,CAAhB;AACA,KAAMC,SAAS,YAAf;;AAEA,KAAIC,aAAa,IAAjB;;AAEA,KAAIC,QAAQ,IAAZ;;AAEA;AAEC,+BAAa;AAAA;;AAEZ,SAAM,IAAIC,KAAJ,CAAU,sDAAV,CAAN;AACA;;AALF;AAAA;AAAA,mCAOuB;;AAErB,WAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAASC,MAAT,EAAmB;;AAErC,SAAIC,cAAcC,OAAOC,SAAP,CAAiBC,IAAjB,CAAsBV,MAAtB,EAA8BD,OAA9B,CAAlB;;AAEAQ,iBAAYI,eAAZ,GAA8B,aAAK;;AAElCd,wBAAkBe,aAAlB,CAAgCC,EAAEC,MAAF,CAASC,MAAzC;AACA,MAHD;;AAKAR,iBAAYS,SAAZ,GAAwB,aAAI;;AAE3B,UAAG,CAACf,UAAJ,EAAe;AACdA,oBAAaY,EAAEC,MAAF,CAASC,MAAtB;AACAb,eAAQD,WAAWC,KAAX,CAAiBe,IAAjB,CAAsBhB,UAAtB,CAAR;AACA;AACAA,kBAAWC,KAAX,GAAmB,YAAW;AAC7B,cAAM,IAAIC,KAAJ,CAAU,4CAAV,CAAN;AACA,QAFD;AAGA;AACDE,cAAQJ,UAAR;AACA,MAXD;;AAaAM,iBAAYW,OAAZ,GAAsB,aAAI;;AAEzBC,cAAQC,GAAR,CAAYP,EAAEC,MAAF,CAASO,KAArB;;AAEAf,aAAOO,EAAEC,MAAF,CAASO,KAAT,CAAeC,IAAtB;AACA,MALD;AAMA,KA5BM,CAAP;AA6BA;AAtCF;AAAA;AAAA,iCAwCsBrB,UAxCtB,EAwCiC;;AAE/BH,WAAOyB,OAAP,CAAe,iBAAS;AACvB,SAAGtB,WAAWuB,gBAAX,CAA4BC,QAA5B,CAAqCC,KAArC,CAAH,EAA+C;AAC9CzB,iBAAW0B,iBAAX,CAA6BD,KAA7B;AACA;AACDzB,gBAAW2B,iBAAX,CAA6BF,KAA7B,EAAmC,EAACG,eAAc,IAAf,EAAnC;AACA,KALD;AAMA;AAhDF;AAAA;AAAA,qCAkDyB;;AAEtB,QAAG5B,UAAH,EAAc;AACbC;AACAD,kBAAa,IAAb;AACA;AACF;AAxDF;;AAAA;AAAA;AA0DA,CApEuB,EAAxB;;AAsEA","file":"ConnectionFactory.js","sourcesContent":["//função auto invocada, ela vai carregar e ao mesmo tempo executada\r\n//IIFE\r\nvar ConnectionFactory = (function (){\r\n\r\n\tconst stores = ['negociacoes'];\r\n\tconst version = 7;\r\n\tconst dbName = 'aluraframe';\r\n\r\n\tvar connection = null;\r\n\r\n\tvar close = null;\r\n\r\n\treturn class ConnectionFactory{\r\n\r\n\t\tconstructor(){\r\n\r\n\t\t\tthrow new Error(\"Não é possível criar instâncias de ConnectionFactory\");\r\n\t\t}\r\n\r\n\t\tstatic getConnection(){\r\n\r\n\t\t\treturn new Promise((resolve,reject) =>{\r\n\r\n\t\t\t\tlet openRequest = window.indexedDB.open(dbName, version);\r\n\r\n\t\t\t\topenRequest.onupgradeneeded = e => {\r\n\r\n\t\t\t\t\tConnectionFactory._createStores(e.target.result);\t\t\t\t\r\n\t\t\t\t};\r\n\r\n\t\t\t\topenRequest.onsuccess = e =>{\r\n\r\n\t\t\t\t\tif(!connection){\r\n\t\t\t\t\t\tconnection = e.target.result;\r\n\t\t\t\t\t\tclose = connection.close.bind(connection);\r\n\t\t\t\t\t\t//O desenvolvedor não poderá obter uma conexão e a partir desta, fechar, porque assim pode ocorrer um problema geral na aplicação. Para isto, vamos utilizar o Monkey Patch, que consiste forçarmos a modificação de uma API. No caso, nós iremos alterar o método close()\r\n\t\t\t\t\t\tconnection.close = function() {\r\n\t\t\t\t\t\t\tthrow new Error('Você não pode fechar diretamente a conexão');\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresolve(connection);\r\n\t\t\t\t};\r\n\r\n\t\t\t\topenRequest.onerror = e =>{\r\n\r\n\t\t\t\t\tconsole.log(e.target.error);\r\n\r\n\t\t\t\t\treject(e.target.error.name);\r\n\t\t\t\t};\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tstatic _createStores(connection){\r\n\r\n\t\t\tstores.forEach(store => {\r\n\t\t\t\tif(connection.objectStoreNames.contains(store)){\r\n\t\t\t\t\tconnection.deleteObjectStore(store);\r\n\t\t\t\t}\r\n\t\t\t\tconnection.createObjectStore(store,{autoIncrement:true})\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tstatic closeConnection(){\r\n\t\t \r\n\t\t \tif(connection){\r\n\t\t \t\tclose();\r\n\t\t \t\tconnection = null;\r\n\t\t \t}\r\n\t\t}\r\n\t}\r\n})();\r\n\r\n/*\r\n\r\nPorque o codigo acima ficou dessa forma ?\r\npara resolver um problema porque tinha varias variaves com escopo global fora da classe\r\ne qualquer um poderia acessar, então para resolver isso aplicamos\r\num padrão de projeto JavaScript chamado Module Pattern\r\nUm módulo é uma unidade código confinada e que ninguém tem acesso ao conteúdo dentro dele. \r\nUma maneira de criarmos um escopo privado no JavaScript\r\n é colocando o código em uma função\r\n\r\n*/"]}